{"ast":null,"code":"\"use strict\";\n/**\n * Copyright 2019 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Target = void 0;\n\nconst Page_js_1 = require(\"./Page.js\");\n\nconst WebWorker_js_1 = require(\"./WebWorker.js\");\n/**\n * @public\n */\n\n\nclass Target {\n  /**\n   * @internal\n   */\n  constructor(targetInfo, browserContext, sessionFactory, ignoreHTTPSErrors, defaultViewport, screenshotTaskQueue) {\n    this._targetInfo = targetInfo;\n    this._browserContext = browserContext;\n    this._targetId = targetInfo.targetId;\n    this._sessionFactory = sessionFactory;\n    this._ignoreHTTPSErrors = ignoreHTTPSErrors;\n    this._defaultViewport = defaultViewport;\n    this._screenshotTaskQueue = screenshotTaskQueue;\n    /** @type {?Promise<!Puppeteer.Page>} */\n\n    this._pagePromise = null;\n    /** @type {?Promise<!WebWorker>} */\n\n    this._workerPromise = null;\n    this._initializedPromise = new Promise(fulfill => this._initializedCallback = fulfill).then(async success => {\n      if (!success) return false;\n      const opener = this.opener();\n      if (!opener || !opener._pagePromise || this.type() !== 'page') return true;\n      const openerPage = await opener._pagePromise;\n      if (!openerPage.listenerCount(\"popup\"\n      /* Popup */\n      )) return true;\n      const popupPage = await this.page();\n      openerPage.emit(\"popup\"\n      /* Popup */\n      , popupPage);\n      return true;\n    });\n    this._isClosedPromise = new Promise(fulfill => this._closedCallback = fulfill);\n    this._isInitialized = this._targetInfo.type !== 'page' || this._targetInfo.url !== '';\n    if (this._isInitialized) this._initializedCallback(true);\n  }\n  /**\n   * Creates a Chrome Devtools Protocol session attached to the target.\n   */\n\n\n  createCDPSession() {\n    return this._sessionFactory();\n  }\n  /**\n   * If the target is not of type `\"page\"` or `\"background_page\"`, returns `null`.\n   */\n\n\n  async page() {\n    if ((this._targetInfo.type === 'page' || this._targetInfo.type === 'background_page' || this._targetInfo.type === 'webview') && !this._pagePromise) {\n      this._pagePromise = this._sessionFactory().then(client => Page_js_1.Page.create(client, this, this._ignoreHTTPSErrors, this._defaultViewport, this._screenshotTaskQueue));\n    }\n\n    return this._pagePromise;\n  }\n  /**\n   * If the target is not of type `\"service_worker\"` or `\"shared_worker\"`, returns `null`.\n   */\n\n\n  async worker() {\n    if (this._targetInfo.type !== 'service_worker' && this._targetInfo.type !== 'shared_worker') return null;\n\n    if (!this._workerPromise) {\n      // TODO(einbinder): Make workers send their console logs.\n      this._workerPromise = this._sessionFactory().then(client => new WebWorker_js_1.WebWorker(client, this._targetInfo.url, () => {}\n      /* consoleAPICalled */\n      , () => {}\n      /* exceptionThrown */\n      ));\n    }\n\n    return this._workerPromise;\n  }\n\n  url() {\n    return this._targetInfo.url;\n  }\n  /**\n   * Identifies what kind of target this is.\n   *\n   * @remarks\n   *\n   * See {@link https://developer.chrome.com/extensions/background_pages | docs} for more info about background pages.\n   */\n\n\n  type() {\n    const type = this._targetInfo.type;\n    if (type === 'page' || type === 'background_page' || type === 'service_worker' || type === 'shared_worker' || type === 'browser' || type === 'webview') return type;\n    return 'other';\n  }\n  /**\n   * Get the browser the target belongs to.\n   */\n\n\n  browser() {\n    return this._browserContext.browser();\n  }\n  /**\n   * Get the browser context the target belongs to.\n   */\n\n\n  browserContext() {\n    return this._browserContext;\n  }\n  /**\n   * Get the target that opened this target. Top-level targets return `null`.\n   */\n\n\n  opener() {\n    const {\n      openerId\n    } = this._targetInfo;\n    if (!openerId) return null;\n    return this.browser()._targets.get(openerId);\n  }\n  /**\n   * @internal\n   */\n\n\n  _targetInfoChanged(targetInfo) {\n    this._targetInfo = targetInfo;\n\n    if (!this._isInitialized && (this._targetInfo.type !== 'page' || this._targetInfo.url !== '')) {\n      this._isInitialized = true;\n\n      this._initializedCallback(true);\n\n      return;\n    }\n  }\n\n}\n\nexports.Target = Target;","map":{"version":3,"mappings":"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","names":["Target","constructor","targetInfo","browserContext","sessionFactory","ignoreHTTPSErrors","defaultViewport","screenshotTaskQueue","_targetInfo","_browserContext","_targetId","targetId","_sessionFactory","_ignoreHTTPSErrors","_defaultViewport","_screenshotTaskQueue","_pagePromise","_workerPromise","_initializedPromise","Promise","fulfill","_initializedCallback","then","success","opener","type","openerPage","listenerCount","popupPage","page","emit","_isClosedPromise","_closedCallback","_isInitialized","url","createCDPSession","client","Page_js_1","create","worker","WebWorker_js_1","browser","openerId","_targets","get","_targetInfoChanged","exports"],"sources":["../../../../src/common/Target.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}