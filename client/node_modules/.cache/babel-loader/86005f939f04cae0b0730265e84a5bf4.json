{"ast":null,"code":"\"use strict\";\n/**\n * Copyright 2019 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WaitTask = exports.DOMWorld = void 0;\n\nconst assert_js_1 = require(\"./assert.js\");\n\nconst helper_js_1 = require(\"./helper.js\");\n\nconst LifecycleWatcher_js_1 = require(\"./LifecycleWatcher.js\");\n\nconst Errors_js_1 = require(\"./Errors.js\");\n\nconst QueryHandler_js_1 = require(\"./QueryHandler.js\");\n\nconst environment_js_1 = require(\"../environment.js\");\n/**\n * @internal\n */\n\n\nclass DOMWorld {\n  constructor(client, frameManager, frame, timeoutSettings) {\n    this._documentPromise = null;\n    this._contextPromise = null;\n    this._contextResolveCallback = null;\n    this._detached = false;\n    /**\n     * @internal\n     */\n\n    this._waitTasks = new Set();\n    /**\n     * @internal\n     * Contains mapping from functions that should be bound to Puppeteer functions.\n     */\n\n    this._boundFunctions = new Map(); // Set of bindings that have been registered in the current context.\n\n    this._ctxBindings = new Set(); // If multiple waitFor are set up asynchronously, we need to wait for the\n    // first one to set up the binding in the page before running the others.\n\n    this._settingUpBinding = null; // Keep own reference to client because it might differ from the FrameManager's\n    // client for OOP iframes.\n\n    this._client = client;\n    this._frameManager = frameManager;\n    this._frame = frame;\n    this._timeoutSettings = timeoutSettings;\n\n    this._setContext(null);\n\n    this._onBindingCalled = this._onBindingCalled.bind(this);\n\n    this._client.on('Runtime.bindingCalled', this._onBindingCalled);\n  }\n\n  frame() {\n    return this._frame;\n  }\n\n  async _setContext(context) {\n    if (context) {\n      (0, assert_js_1.assert)(this._contextResolveCallback, 'Execution Context has already been set.');\n\n      this._ctxBindings.clear();\n\n      this._contextResolveCallback.call(null, context);\n\n      this._contextResolveCallback = null;\n\n      for (const waitTask of this._waitTasks) waitTask.rerun();\n    } else {\n      this._documentPromise = null;\n      this._contextPromise = new Promise(fulfill => {\n        this._contextResolveCallback = fulfill;\n      });\n    }\n  }\n\n  _hasContext() {\n    return !this._contextResolveCallback;\n  }\n\n  _detach() {\n    this._detached = true;\n\n    this._client.off('Runtime.bindingCalled', this._onBindingCalled);\n\n    for (const waitTask of this._waitTasks) waitTask.terminate(new Error('waitForFunction failed: frame got detached.'));\n  }\n\n  executionContext() {\n    if (this._detached) throw new Error(`Execution context is not available in detached frame \"${this._frame.url()}\" (are you trying to evaluate?)`);\n    return this._contextPromise;\n  }\n\n  async evaluateHandle(pageFunction) {\n    const context = await this.executionContext();\n\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n\n    return context.evaluateHandle(pageFunction, ...args);\n  }\n\n  async evaluate(pageFunction) {\n    const context = await this.executionContext();\n\n    for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      args[_key2 - 1] = arguments[_key2];\n    }\n\n    return context.evaluate(pageFunction, ...args);\n  }\n\n  async $(selector) {\n    const document = await this._document();\n    const value = await document.$(selector);\n    return value;\n  }\n\n  async _document() {\n    if (this._documentPromise) return this._documentPromise;\n    this._documentPromise = this.executionContext().then(async context => {\n      const document = await context.evaluateHandle('document');\n      return document.asElement();\n    });\n    return this._documentPromise;\n  }\n\n  async $x(expression) {\n    const document = await this._document();\n    const value = await document.$x(expression);\n    return value;\n  }\n\n  async $eval(selector, pageFunction) {\n    const document = await this._document();\n\n    for (var _len3 = arguments.length, args = new Array(_len3 > 2 ? _len3 - 2 : 0), _key3 = 2; _key3 < _len3; _key3++) {\n      args[_key3 - 2] = arguments[_key3];\n    }\n\n    return document.$eval(selector, pageFunction, ...args);\n  }\n\n  async $$eval(selector, pageFunction) {\n    const document = await this._document();\n\n    for (var _len4 = arguments.length, args = new Array(_len4 > 2 ? _len4 - 2 : 0), _key4 = 2; _key4 < _len4; _key4++) {\n      args[_key4 - 2] = arguments[_key4];\n    }\n\n    const value = await document.$$eval(selector, pageFunction, ...args);\n    return value;\n  }\n\n  async $$(selector) {\n    const document = await this._document();\n    const value = await document.$$(selector);\n    return value;\n  }\n\n  async content() {\n    return await this.evaluate(() => {\n      let retVal = '';\n      if (document.doctype) retVal = new XMLSerializer().serializeToString(document.doctype);\n      if (document.documentElement) retVal += document.documentElement.outerHTML;\n      return retVal;\n    });\n  }\n\n  async setContent(html) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const {\n      waitUntil = ['load'],\n      timeout = this._timeoutSettings.navigationTimeout()\n    } = options; // We rely upon the fact that document.open() will reset frame lifecycle with \"init\"\n    // lifecycle event. @see https://crrev.com/608658\n\n    await this.evaluate(html => {\n      document.open();\n      document.write(html);\n      document.close();\n    }, html);\n    const watcher = new LifecycleWatcher_js_1.LifecycleWatcher(this._frameManager, this._frame, waitUntil, timeout);\n    const error = await Promise.race([watcher.timeoutOrTerminationPromise(), watcher.lifecyclePromise()]);\n    watcher.dispose();\n    if (error) throw error;\n  }\n  /**\n   * Adds a script tag into the current context.\n   *\n   * @remarks\n   *\n   * You can pass a URL, filepath or string of contents. Note that when running Puppeteer\n   * in a browser environment you cannot pass a filepath and should use either\n   * `url` or `content`.\n   */\n\n\n  async addScriptTag(options) {\n    const {\n      url = null,\n      path = null,\n      content = null,\n      id = '',\n      type = ''\n    } = options;\n\n    if (url !== null) {\n      try {\n        const context = await this.executionContext();\n        return (await context.evaluateHandle(addScriptUrl, url, id, type)).asElement();\n      } catch (error) {\n        throw new Error(`Loading script from ${url} failed`);\n      }\n    }\n\n    if (path !== null) {\n      if (!environment_js_1.isNode) {\n        throw new Error('Cannot pass a filepath to addScriptTag in the browser environment.');\n      }\n\n      const fs = await helper_js_1.helper.importFSModule();\n      let contents = await fs.promises.readFile(path, 'utf8');\n      contents += '//# sourceURL=' + path.replace(/\\n/g, '');\n      const context = await this.executionContext();\n      return (await context.evaluateHandle(addScriptContent, contents, id, type)).asElement();\n    }\n\n    if (content !== null) {\n      const context = await this.executionContext();\n      return (await context.evaluateHandle(addScriptContent, content, id, type)).asElement();\n    }\n\n    throw new Error('Provide an object with a `url`, `path` or `content` property');\n\n    async function addScriptUrl(url, id, type) {\n      const script = document.createElement('script');\n      script.src = url;\n      if (id) script.id = id;\n      if (type) script.type = type;\n      const promise = new Promise((res, rej) => {\n        script.onload = res;\n        script.onerror = rej;\n      });\n      document.head.appendChild(script);\n      await promise;\n      return script;\n    }\n\n    function addScriptContent(content, id) {\n      let type = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'text/javascript';\n      const script = document.createElement('script');\n      script.type = type;\n      script.text = content;\n      if (id) script.id = id;\n      let error = null;\n\n      script.onerror = e => error = e;\n\n      document.head.appendChild(script);\n      if (error) throw error;\n      return script;\n    }\n  }\n  /**\n   * Adds a style tag into the current context.\n   *\n   * @remarks\n   *\n   * You can pass a URL, filepath or string of contents. Note that when running Puppeteer\n   * in a browser environment you cannot pass a filepath and should use either\n   * `url` or `content`.\n   *\n   */\n\n\n  async addStyleTag(options) {\n    const {\n      url = null,\n      path = null,\n      content = null\n    } = options;\n\n    if (url !== null) {\n      try {\n        const context = await this.executionContext();\n        return (await context.evaluateHandle(addStyleUrl, url)).asElement();\n      } catch (error) {\n        throw new Error(`Loading style from ${url} failed`);\n      }\n    }\n\n    if (path !== null) {\n      if (!environment_js_1.isNode) {\n        throw new Error('Cannot pass a filepath to addStyleTag in the browser environment.');\n      }\n\n      const fs = await helper_js_1.helper.importFSModule();\n      let contents = await fs.promises.readFile(path, 'utf8');\n      contents += '/*# sourceURL=' + path.replace(/\\n/g, '') + '*/';\n      const context = await this.executionContext();\n      return (await context.evaluateHandle(addStyleContent, contents)).asElement();\n    }\n\n    if (content !== null) {\n      const context = await this.executionContext();\n      return (await context.evaluateHandle(addStyleContent, content)).asElement();\n    }\n\n    throw new Error('Provide an object with a `url`, `path` or `content` property');\n\n    async function addStyleUrl(url) {\n      const link = document.createElement('link');\n      link.rel = 'stylesheet';\n      link.href = url;\n      const promise = new Promise((res, rej) => {\n        link.onload = res;\n        link.onerror = rej;\n      });\n      document.head.appendChild(link);\n      await promise;\n      return link;\n    }\n\n    async function addStyleContent(content) {\n      const style = document.createElement('style');\n      style.type = 'text/css';\n      style.appendChild(document.createTextNode(content));\n      const promise = new Promise((res, rej) => {\n        style.onload = res;\n        style.onerror = rej;\n      });\n      document.head.appendChild(style);\n      await promise;\n      return style;\n    }\n  }\n\n  async click(selector, options) {\n    const handle = await this.$(selector);\n    (0, assert_js_1.assert)(handle, 'No node found for selector: ' + selector);\n    await handle.click(options);\n    await handle.dispose();\n  }\n\n  async focus(selector) {\n    const handle = await this.$(selector);\n    (0, assert_js_1.assert)(handle, 'No node found for selector: ' + selector);\n    await handle.focus();\n    await handle.dispose();\n  }\n\n  async hover(selector) {\n    const handle = await this.$(selector);\n    (0, assert_js_1.assert)(handle, 'No node found for selector: ' + selector);\n    await handle.hover();\n    await handle.dispose();\n  }\n\n  async select(selector) {\n    const handle = await this.$(selector);\n    (0, assert_js_1.assert)(handle, 'No node found for selector: ' + selector);\n\n    for (var _len5 = arguments.length, values = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {\n      values[_key5 - 1] = arguments[_key5];\n    }\n\n    const result = await handle.select(...values);\n    await handle.dispose();\n    return result;\n  }\n\n  async tap(selector) {\n    const handle = await this.$(selector);\n    await handle.tap();\n    await handle.dispose();\n  }\n\n  async type(selector, text, options) {\n    const handle = await this.$(selector);\n    (0, assert_js_1.assert)(handle, 'No node found for selector: ' + selector);\n    await handle.type(text, options);\n    await handle.dispose();\n  }\n\n  async waitForSelector(selector, options) {\n    const {\n      updatedSelector,\n      queryHandler\n    } = (0, QueryHandler_js_1.getQueryHandlerAndSelector)(selector);\n    return queryHandler.waitFor(this, updatedSelector, options);\n  }\n  /**\n   * @internal\n   */\n\n\n  async addBindingToContext(context, name) {\n    // Previous operation added the binding so we are done.\n    if (this._ctxBindings.has(DOMWorld.bindingIdentifier(name, context._contextId))) {\n      return;\n    } // Wait for other operation to finish\n\n\n    if (this._settingUpBinding) {\n      await this._settingUpBinding;\n      return this.addBindingToContext(context, name);\n    }\n\n    const bind = async name => {\n      const expression = helper_js_1.helper.pageBindingInitString('internal', name);\n\n      try {\n        // TODO: In theory, it would be enough to call this just once\n        await context._client.send('Runtime.addBinding', {\n          name,\n          // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n          // @ts-ignore The protocol definition is not up to date.\n          executionContextName: context._contextName\n        });\n        await context.evaluate(expression);\n      } catch (error) {\n        // We could have tried to evaluate in a context which was already\n        // destroyed. This happens, for example, if the page is navigated while\n        // we are trying to add the binding\n        const ctxDestroyed = error.message.includes('Execution context was destroyed');\n        const ctxNotFound = error.message.includes('Cannot find context with specified id');\n\n        if (ctxDestroyed || ctxNotFound) {\n          return;\n        } else {\n          (0, helper_js_1.debugError)(error);\n          return;\n        }\n      }\n\n      this._ctxBindings.add(DOMWorld.bindingIdentifier(name, context._contextId));\n    };\n\n    this._settingUpBinding = bind(name);\n    await this._settingUpBinding;\n    this._settingUpBinding = null;\n  }\n\n  async _onBindingCalled(event) {\n    let payload;\n    if (!this._hasContext()) return;\n    const context = await this.executionContext();\n\n    try {\n      payload = JSON.parse(event.payload);\n    } catch {\n      // The binding was either called by something in the page or it was\n      // called before our wrapper was initialized.\n      return;\n    }\n\n    const {\n      type,\n      name,\n      seq,\n      args\n    } = payload;\n    if (type !== 'internal' || !this._ctxBindings.has(DOMWorld.bindingIdentifier(name, context._contextId))) return;\n    if (context._contextId !== event.executionContextId) return;\n\n    try {\n      const result = await this._boundFunctions.get(name)(...args);\n      await context.evaluate(deliverResult, name, seq, result);\n    } catch (error) {\n      // The WaitTask may already have been resolved by timing out, or the\n      // exection context may have been destroyed.\n      // In both caes, the promises above are rejected with a protocol error.\n      // We can safely ignores these, as the WaitTask is re-installed in\n      // the next execution context if needed.\n      if (error.message.includes('Protocol error')) return;\n      (0, helper_js_1.debugError)(error);\n    }\n\n    function deliverResult(name, seq, result) {\n      globalThis[name].callbacks.get(seq).resolve(result);\n      globalThis[name].callbacks.delete(seq);\n    }\n  }\n  /**\n   * @internal\n   */\n\n\n  async waitForSelectorInPage(queryOne, selector, options, binding) {\n    const {\n      visible: waitForVisible = false,\n      hidden: waitForHidden = false,\n      timeout = this._timeoutSettings.timeout()\n    } = options;\n    const polling = waitForVisible || waitForHidden ? 'raf' : 'mutation';\n    const title = `selector \\`${selector}\\`${waitForHidden ? ' to be hidden' : ''}`;\n\n    async function predicate(root, selector, waitForVisible, waitForHidden) {\n      const node = predicateQueryHandler ? await predicateQueryHandler(root, selector) : root.querySelector(selector);\n      return checkWaitForOptions(node, waitForVisible, waitForHidden);\n    }\n\n    const waitTaskOptions = {\n      domWorld: this,\n      predicateBody: helper_js_1.helper.makePredicateString(predicate, queryOne),\n      predicateAcceptsContextElement: true,\n      title,\n      polling,\n      timeout,\n      args: [selector, waitForVisible, waitForHidden],\n      binding,\n      root: options.root\n    };\n    const waitTask = new WaitTask(waitTaskOptions);\n    const jsHandle = await waitTask.promise;\n    const elementHandle = jsHandle.asElement();\n\n    if (!elementHandle) {\n      await jsHandle.dispose();\n      return null;\n    }\n\n    return elementHandle;\n  }\n\n  async waitForXPath(xpath, options) {\n    const {\n      visible: waitForVisible = false,\n      hidden: waitForHidden = false,\n      timeout = this._timeoutSettings.timeout()\n    } = options;\n    const polling = waitForVisible || waitForHidden ? 'raf' : 'mutation';\n    const title = `XPath \\`${xpath}\\`${waitForHidden ? ' to be hidden' : ''}`;\n\n    function predicate(root, xpath, waitForVisible, waitForHidden) {\n      const node = document.evaluate(xpath, root, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\n      return checkWaitForOptions(node, waitForVisible, waitForHidden);\n    }\n\n    const waitTaskOptions = {\n      domWorld: this,\n      predicateBody: helper_js_1.helper.makePredicateString(predicate),\n      predicateAcceptsContextElement: true,\n      title,\n      polling,\n      timeout,\n      args: [xpath, waitForVisible, waitForHidden],\n      root: options.root\n    };\n    const waitTask = new WaitTask(waitTaskOptions);\n    const jsHandle = await waitTask.promise;\n    const elementHandle = jsHandle.asElement();\n\n    if (!elementHandle) {\n      await jsHandle.dispose();\n      return null;\n    }\n\n    return elementHandle;\n  }\n\n  waitForFunction(pageFunction) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const {\n      polling = 'raf',\n      timeout = this._timeoutSettings.timeout()\n    } = options;\n\n    for (var _len6 = arguments.length, args = new Array(_len6 > 2 ? _len6 - 2 : 0), _key6 = 2; _key6 < _len6; _key6++) {\n      args[_key6 - 2] = arguments[_key6];\n    }\n\n    const waitTaskOptions = {\n      domWorld: this,\n      predicateBody: pageFunction,\n      predicateAcceptsContextElement: false,\n      title: 'function',\n      polling,\n      timeout,\n      args\n    };\n    const waitTask = new WaitTask(waitTaskOptions);\n    return waitTask.promise;\n  }\n\n  async title() {\n    return this.evaluate(() => document.title);\n  }\n\n}\n\nexports.DOMWorld = DOMWorld;\n\nDOMWorld.bindingIdentifier = (name, contextId) => `${name}_${contextId}`;\n/**\n * @internal\n */\n\n\nclass WaitTask {\n  constructor(options) {\n    this._runCount = 0;\n    this._terminated = false;\n    this._root = null;\n    if (helper_js_1.helper.isString(options.polling)) (0, assert_js_1.assert)(options.polling === 'raf' || options.polling === 'mutation', 'Unknown polling option: ' + options.polling);else if (helper_js_1.helper.isNumber(options.polling)) (0, assert_js_1.assert)(options.polling > 0, 'Cannot poll with non-positive interval: ' + options.polling);else throw new Error('Unknown polling options: ' + options.polling);\n\n    function getPredicateBody(predicateBody) {\n      if (helper_js_1.helper.isString(predicateBody)) return `return (${predicateBody});`;\n      return `return (${predicateBody})(...args);`;\n    }\n\n    this._domWorld = options.domWorld;\n    this._polling = options.polling;\n    this._timeout = options.timeout;\n    this._root = options.root;\n    this._predicateBody = getPredicateBody(options.predicateBody);\n    this._predicateAcceptsContextElement = options.predicateAcceptsContextElement;\n    this._args = options.args;\n    this._binding = options.binding;\n    this._runCount = 0;\n\n    this._domWorld._waitTasks.add(this);\n\n    if (this._binding) {\n      this._domWorld._boundFunctions.set(this._binding.name, this._binding.pptrFunction);\n    }\n\n    this.promise = new Promise((resolve, reject) => {\n      this._resolve = resolve;\n      this._reject = reject;\n    }); // Since page navigation requires us to re-install the pageScript, we should track\n    // timeout on our end.\n\n    if (options.timeout) {\n      const timeoutError = new Errors_js_1.TimeoutError(`waiting for ${options.title} failed: timeout ${options.timeout}ms exceeded`);\n      this._timeoutTimer = setTimeout(() => this.terminate(timeoutError), options.timeout);\n    }\n\n    this.rerun();\n  }\n\n  terminate(error) {\n    this._terminated = true;\n\n    this._reject(error);\n\n    this._cleanup();\n  }\n\n  async rerun() {\n    const runCount = ++this._runCount;\n    let success = null;\n    let error = null;\n    const context = await this._domWorld.executionContext();\n    if (this._terminated || runCount !== this._runCount) return;\n\n    if (this._binding) {\n      await this._domWorld.addBindingToContext(context, this._binding.name);\n    }\n\n    if (this._terminated || runCount !== this._runCount) return;\n\n    try {\n      success = await context.evaluateHandle(waitForPredicatePageFunction, this._root || null, this._predicateBody, this._predicateAcceptsContextElement, this._polling, this._timeout, ...this._args);\n    } catch (error_) {\n      error = error_;\n    }\n\n    if (this._terminated || runCount !== this._runCount) {\n      if (success) await success.dispose();\n      return;\n    } // Ignore timeouts in pageScript - we track timeouts ourselves.\n    // If the frame's execution context has already changed, `frame.evaluate` will\n    // throw an error - ignore this predicate run altogether.\n\n\n    if (!error && (await this._domWorld.evaluate(s => !s, success).catch(() => true))) {\n      await success.dispose();\n      return;\n    }\n\n    if (error) {\n      if (error.message.includes('TypeError: binding is not a function')) {\n        return this.rerun();\n      } // When frame is detached the task should have been terminated by the DOMWorld.\n      // This can fail if we were adding this task while the frame was detached,\n      // so we terminate here instead.\n\n\n      if (error.message.includes('Execution context is not available in detached frame')) {\n        this.terminate(new Error('waitForFunction failed: frame got detached.'));\n        return;\n      } // When the page is navigated, the promise is rejected.\n      // We will try again in the new execution context.\n\n\n      if (error.message.includes('Execution context was destroyed')) return; // We could have tried to evaluate in a context which was already\n      // destroyed.\n\n      if (error.message.includes('Cannot find context with specified id')) return;\n\n      this._reject(error);\n    } else {\n      this._resolve(success);\n    }\n\n    this._cleanup();\n  }\n\n  _cleanup() {\n    clearTimeout(this._timeoutTimer);\n\n    this._domWorld._waitTasks.delete(this);\n  }\n\n}\n\nexports.WaitTask = WaitTask;\n\nasync function waitForPredicatePageFunction(root, predicateBody, predicateAcceptsContextElement, polling, timeout) {\n  for (var _len7 = arguments.length, args = new Array(_len7 > 5 ? _len7 - 5 : 0), _key7 = 5; _key7 < _len7; _key7++) {\n    args[_key7 - 5] = arguments[_key7];\n  }\n\n  root = root || document;\n  const predicate = new Function('...args', predicateBody);\n  let timedOut = false;\n  if (timeout) setTimeout(() => timedOut = true, timeout);\n  if (polling === 'raf') return await pollRaf();\n  if (polling === 'mutation') return await pollMutation();\n  if (typeof polling === 'number') return await pollInterval(polling);\n  /**\n   * @returns {!Promise<*>}\n   */\n\n  async function pollMutation() {\n    const success = predicateAcceptsContextElement ? await predicate(root, ...args) : await predicate(...args);\n    if (success) return Promise.resolve(success);\n    let fulfill;\n    const result = new Promise(x => fulfill = x);\n    const observer = new MutationObserver(async () => {\n      if (timedOut) {\n        observer.disconnect();\n        fulfill();\n      }\n\n      const success = predicateAcceptsContextElement ? await predicate(root, ...args) : await predicate(...args);\n\n      if (success) {\n        observer.disconnect();\n        fulfill(success);\n      }\n    });\n    observer.observe(root, {\n      childList: true,\n      subtree: true,\n      attributes: true\n    });\n    return result;\n  }\n\n  async function pollRaf() {\n    let fulfill;\n    const result = new Promise(x => fulfill = x);\n    await onRaf();\n    return result;\n\n    async function onRaf() {\n      if (timedOut) {\n        fulfill();\n        return;\n      }\n\n      const success = predicateAcceptsContextElement ? await predicate(root, ...args) : await predicate(...args);\n      if (success) fulfill(success);else requestAnimationFrame(onRaf);\n    }\n  }\n\n  async function pollInterval(pollInterval) {\n    let fulfill;\n    const result = new Promise(x => fulfill = x);\n    await onTimeout();\n    return result;\n\n    async function onTimeout() {\n      if (timedOut) {\n        fulfill();\n        return;\n      }\n\n      const success = predicateAcceptsContextElement ? await predicate(root, ...args) : await predicate(...args);\n      if (success) fulfill(success);else setTimeout(onTimeout, pollInterval);\n    }\n  }\n}","map":{"version":3,"mappings":"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","names":["DOMWorld","constructor","client","frameManager","frame","timeoutSettings","Set","Map","_client","_frameManager","_frame","_timeoutSettings","_setContext","_onBindingCalled","bind","on","context","_contextResolveCallback","_ctxBindings","clear","call","waitTask","_waitTasks","rerun","_documentPromise","_contextPromise","Promise","fulfill","_hasContext","_detach","_detached","off","terminate","Error","executionContext","url","evaluateHandle","pageFunction","args","evaluate","$","selector","document","_document","value","then","asElement","$x","expression","$eval","$$eval","$$","content","retVal","doctype","XMLSerializer","serializeToString","documentElement","outerHTML","setContent","html","options","waitUntil","timeout","navigationTimeout","open","write","close","watcher","LifecycleWatcher_js_1","error","race","timeoutOrTerminationPromise","lifecyclePromise","dispose","addScriptTag","path","id","type","addScriptUrl","environment_js_1","fs","helper_js_1","importFSModule","contents","promises","readFile","replace","addScriptContent","script","createElement","src","promise","res","rej","onload","onerror","head","appendChild","text","e","addStyleTag","addStyleUrl","addStyleContent","link","rel","href","style","createTextNode","click","handle","focus","hover","select","values","result","tap","waitForSelector","updatedSelector","queryHandler","waitFor","addBindingToContext","name","has","bindingIdentifier","_contextId","_settingUpBinding","pageBindingInitString","send","executionContextName","_contextName","ctxDestroyed","message","includes","ctxNotFound","add","event","payload","JSON","parse","seq","executionContextId","_boundFunctions","get","deliverResult","globalThis","callbacks","resolve","delete","waitForSelectorInPage","queryOne","binding","visible","waitForVisible","hidden","waitForHidden","polling","title","predicate","root","node","predicateQueryHandler","querySelector","checkWaitForOptions","waitTaskOptions","domWorld","predicateBody","makePredicateString","predicateAcceptsContextElement","WaitTask","jsHandle","elementHandle","waitForXPath","xpath","XPathResult","FIRST_ORDERED_NODE_TYPE","singleNodeValue","waitForFunction","exports","contextId","isString","isNumber","getPredicateBody","_domWorld","_polling","_timeout","_root","_predicateBody","_predicateAcceptsContextElement","_args","_binding","_runCount","set","pptrFunction","reject","_resolve","_reject","timeoutError","Errors_js_1","_timeoutTimer","setTimeout","_terminated","_cleanup","runCount","success","waitForPredicatePageFunction","error_","s","catch","clearTimeout","Function","timedOut","pollRaf","pollMutation","pollInterval","x","observer","MutationObserver","disconnect","observe","childList","subtree","attributes","onRaf","requestAnimationFrame","onTimeout"],"sources":["../../../../src/common/DOMWorld.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}