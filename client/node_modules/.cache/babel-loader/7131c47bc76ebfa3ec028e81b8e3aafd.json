{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Tracing = void 0;\n/**\n * Copyright 2017 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst assert_js_1 = require(\"./assert.js\");\n\nconst helper_js_1 = require(\"./helper.js\");\n/**\n * The Tracing class exposes the tracing audit interface.\n * @remarks\n * You can use `tracing.start` and `tracing.stop` to create a trace file\n * which can be opened in Chrome DevTools or {@link https://chromedevtools.github.io/timeline-viewer/ | timeline viewer}.\n *\n * @example\n * ```js\n * await page.tracing.start({path: 'trace.json'});\n * await page.goto('https://www.google.com');\n * await page.tracing.stop();\n * ```\n *\n * @public\n */\n\n\nclass Tracing {\n  /**\n   * @internal\n   */\n  constructor(client) {\n    this._recording = false;\n    this._path = '';\n    this._client = client;\n  }\n  /**\n   * Starts a trace for the current page.\n   * @remarks\n   * Only one trace can be active at a time per browser.\n   * @param options - Optional `TracingOptions`.\n   */\n\n\n  async start() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    (0, assert_js_1.assert)(!this._recording, 'Cannot start recording trace while already recording trace.');\n    const defaultCategories = ['-*', 'devtools.timeline', 'v8.execute', 'disabled-by-default-devtools.timeline', 'disabled-by-default-devtools.timeline.frame', 'toplevel', 'blink.console', 'blink.user_timing', 'latencyInfo', 'disabled-by-default-devtools.timeline.stack', 'disabled-by-default-v8.cpu_profiler'];\n    const {\n      path = null,\n      screenshots = false,\n      categories = defaultCategories\n    } = options;\n    if (screenshots) categories.push('disabled-by-default-devtools.screenshot');\n    const excludedCategories = categories.filter(cat => cat.startsWith('-')).map(cat => cat.slice(1));\n    const includedCategories = categories.filter(cat => !cat.startsWith('-'));\n    this._path = path;\n    this._recording = true;\n    await this._client.send('Tracing.start', {\n      transferMode: 'ReturnAsStream',\n      traceConfig: {\n        excludedCategories,\n        includedCategories\n      }\n    });\n  }\n  /**\n   * Stops a trace started with the `start` method.\n   * @returns Promise which resolves to buffer with trace data.\n   */\n\n\n  async stop() {\n    let fulfill;\n    let reject;\n    const contentPromise = new Promise((x, y) => {\n      fulfill = x;\n      reject = y;\n    });\n\n    this._client.once('Tracing.tracingComplete', async event => {\n      try {\n        const readable = await helper_js_1.helper.getReadableFromProtocolStream(this._client, event.stream);\n        const buffer = await helper_js_1.helper.getReadableAsBuffer(readable, this._path);\n        fulfill(buffer);\n      } catch (error) {\n        reject(error);\n      }\n    });\n\n    await this._client.send('Tracing.end');\n    this._recording = false;\n    return contentPromise;\n  }\n\n}\n\nexports.Tracing = Tracing;","map":{"version":3,"mappings":";;;;;;AAAA;;;;;;;;;;;;;;;;AAeA;;AACA;AAYA;;;;;;;;;;;;;;;;;AAeA,MAAaA,OAAb,CAAoB;AAKlB;;;AAGAC,cAAYC,MAAZ,EAA8B;AAN9B,sBAAa,KAAb;AACA,iBAAQ,EAAR;AAME,SAAKC,OAAL,GAAeD,MAAf;AACD;AAED;;;;;;;;AAMW,QAALE,KAAK,GAA6B;AAAA,QAA5BC,OAA4B,uEAAF,EAAE;AACtC,4BACE,CAAC,KAAKC,UADR,EAEE,6DAFF;AAKA,UAAMC,iBAAiB,GAAG,CACxB,IADwB,EAExB,mBAFwB,EAGxB,YAHwB,EAIxB,uCAJwB,EAKxB,6CALwB,EAMxB,UANwB,EAOxB,eAPwB,EAQxB,mBARwB,EASxB,aATwB,EAUxB,6CAVwB,EAWxB,qCAXwB,CAA1B;AAaA,UAAM;AACJC,UAAI,GAAG,IADH;AAEJC,iBAAW,GAAG,KAFV;AAGJC,gBAAU,GAAGH;AAHT,QAIFF,OAJJ;AAMA,QAAII,WAAJ,EAAiBC,UAAU,CAACC,IAAX,CAAgB,yCAAhB;AAEjB,UAAMC,kBAAkB,GAAGF,UAAU,CAClCG,MADwB,CAChBC,GAAD,IAASA,GAAG,CAACC,UAAJ,CAAe,GAAf,CADQ,EAExBC,GAFwB,CAEnBF,GAAD,IAASA,GAAG,CAACG,KAAJ,CAAU,CAAV,CAFW,CAA3B;AAGA,UAAMC,kBAAkB,GAAGR,UAAU,CAACG,MAAX,CAAmBC,GAAD,IAAS,CAACA,GAAG,CAACC,UAAJ,CAAe,GAAf,CAA5B,CAA3B;AAEA,SAAKI,KAAL,GAAaX,IAAb;AACA,SAAKF,UAAL,GAAkB,IAAlB;AACA,UAAM,KAAKH,OAAL,CAAaiB,IAAb,CAAkB,eAAlB,EAAmC;AACvCC,kBAAY,EAAE,gBADyB;AAEvCC,iBAAW,EAAE;AACXV,0BADW;AAEXM;AAFW;AAF0B,KAAnC,CAAN;AAOD;AAED;;;;;;AAIU,QAAJK,IAAI;AACR,QAAIC,OAAJ;AACA,QAAIC,MAAJ;AACA,UAAMC,cAAc,GAAG,IAAIC,OAAJ,CAAoB,CAACC,CAAD,EAAIC,CAAJ,KAAS;AAClDL,aAAO,GAAGI,CAAV;AACAH,YAAM,GAAGI,CAAT;AACD,KAHsB,CAAvB;;AAIA,SAAK1B,OAAL,CAAa2B,IAAb,CAAkB,yBAAlB,EAA6C,MAAOC,KAAP,IAAgB;AAC3D,UAAI;AACF,cAAMC,QAAQ,GAAG,MAAMC,mBAAOC,6BAAP,CACrB,KAAK/B,OADgB,EAErB4B,KAAK,CAACI,MAFe,CAAvB;AAIA,cAAMC,MAAM,GAAG,MAAMH,mBAAOI,mBAAP,CAA2BL,QAA3B,EAAqC,KAAKb,KAA1C,CAArB;AACAK,eAAO,CAACY,MAAD,CAAP;AACD,OAPD,CAOE,OAAOE,KAAP,EAAc;AACdb,cAAM,CAACa,KAAD,CAAN;AACD;AACF,KAXD;;AAYA,UAAM,KAAKnC,OAAL,CAAaiB,IAAb,CAAkB,aAAlB,CAAN;AACA,SAAKd,UAAL,GAAkB,KAAlB;AACA,WAAOoB,cAAP;AACD;;AAvFiB;;AAApBa","names":["Tracing","constructor","client","_client","start","options","_recording","defaultCategories","path","screenshots","categories","push","excludedCategories","filter","cat","startsWith","map","slice","includedCategories","_path","send","transferMode","traceConfig","stop","fulfill","reject","contentPromise","Promise","x","y","once","event","readable","helper_js_1","getReadableFromProtocolStream","stream","buffer","getReadableAsBuffer","error","exports"],"sources":["../../../../src/common/Tracing.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}