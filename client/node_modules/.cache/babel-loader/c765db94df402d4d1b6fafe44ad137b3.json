{"ast":null,"code":"\"use strict\";\n/**\n * Copyright 2020 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.connectToBrowser = void 0;\n\nconst Browser_js_1 = require(\"./Browser.js\");\n\nconst assert_js_1 = require(\"./assert.js\");\n\nconst helper_js_1 = require(\"../common/helper.js\");\n\nconst Connection_js_1 = require(\"./Connection.js\");\n\nconst environment_js_1 = require(\"../environment.js\");\n\nconst fetch_js_1 = require(\"./fetch.js\");\n\nconst getWebSocketTransportClass = async () => {\n  return environment_js_1.isNode ? (await Promise.resolve().then(() => __importStar(require('../node/NodeWebSocketTransport.js')))).NodeWebSocketTransport : (await Promise.resolve().then(() => __importStar(require('./BrowserWebSocketTransport.js')))).BrowserWebSocketTransport;\n};\n/**\n * Users should never call this directly; it's called when calling\n * `puppeteer.connect`.\n * @internal\n */\n\n\nconst connectToBrowser = async options => {\n  const {\n    browserWSEndpoint,\n    browserURL,\n    ignoreHTTPSErrors = false,\n    defaultViewport = {\n      width: 800,\n      height: 600\n    },\n    transport,\n    slowMo = 0,\n    targetFilter\n  } = options;\n  (0, assert_js_1.assert)(Number(!!browserWSEndpoint) + Number(!!browserURL) + Number(!!transport) === 1, 'Exactly one of browserWSEndpoint, browserURL or transport must be passed to puppeteer.connect');\n  let connection = null;\n\n  if (transport) {\n    connection = new Connection_js_1.Connection('', transport, slowMo);\n  } else if (browserWSEndpoint) {\n    const WebSocketClass = await getWebSocketTransportClass();\n    const connectionTransport = await WebSocketClass.create(browserWSEndpoint);\n    connection = new Connection_js_1.Connection(browserWSEndpoint, connectionTransport, slowMo);\n  } else if (browserURL) {\n    const connectionURL = await getWSEndpoint(browserURL);\n    const WebSocketClass = await getWebSocketTransportClass();\n    const connectionTransport = await WebSocketClass.create(connectionURL);\n    connection = new Connection_js_1.Connection(connectionURL, connectionTransport, slowMo);\n  }\n\n  const {\n    browserContextIds\n  } = await connection.send('Target.getBrowserContexts');\n  return Browser_js_1.Browser.create(connection, browserContextIds, ignoreHTTPSErrors, defaultViewport, null, () => connection.send('Browser.close').catch(helper_js_1.debugError), targetFilter);\n};\n\nexports.connectToBrowser = connectToBrowser;\n\nasync function getWSEndpoint(browserURL) {\n  const endpointURL = new URL('/json/version', browserURL);\n  const fetch = await (0, fetch_js_1.getFetch)();\n\n  try {\n    const result = await fetch(endpointURL.toString(), {\n      method: 'GET'\n    });\n\n    if (!result.ok) {\n      throw new Error(`HTTP ${result.statusText}`);\n    }\n\n    const data = await result.json();\n    return data.webSocketDebuggerUrl;\n  } catch (error) {\n    error.message = `Failed to fetch browser webSocket URL from ${endpointURL}: ` + error.message;\n    throw error;\n  }\n}","map":{"version":3,"mappings":"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","names":["getWebSocketTransportClass","environment_js_1","NodeWebSocketTransport","BrowserWebSocketTransport","connectToBrowser","options","browserWSEndpoint","browserURL","ignoreHTTPSErrors","defaultViewport","width","height","transport","slowMo","targetFilter","Number","connection","Connection_js_1","WebSocketClass","connectionTransport","create","connectionURL","getWSEndpoint","browserContextIds","send","Browser_js_1","catch","helper_js_1","exports","endpointURL","URL","fetch","result","toString","method","ok","Error","statusText","data","json","webSocketDebuggerUrl","error","message"],"sources":["../../../../src/common/BrowserConnector.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}